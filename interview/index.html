<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ヾ(◍°∇°◍)ﾉﾞ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css">
	<style type="text/css">
		blockquote {
			border: 1px solid #b3b3b3;
			border-left: 10px solid #b3b3b3;
			border-radius: 0px;
			background: #fafafa;
			font-size: 18px;
			margin: 10px;
			padding: 10px 20px;
		}

		blockquote p {
			margin: 0;
			line-height: 30px;
			padding-bottom: 20px;
		}

		blockquote .small {
			display: block;
			font-size: 80%;
			color: brown;
			text-align: right;
		} 
	</style>
    <style type="text/css">
		body {
			margin: 0px;
			padding: 0px;
		}
		.container {
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
		}
		
		#title {
			display: block;
			text-align: center;
			font-size: 20px;
			font-weight: bold;
			line-height: 40px;
			height: 40px;
		}
		.data {
			flex: 1;
			overflow: scroll;
		}
		#content {
			overflow-wrap: break-word;
		}
		.center {
			width: 100%;
			text-align: center;
			display: block;
		}
		
		.nav1 {
			display: flex;
			// width: 90%;
			// left: 50%;
			// bottom: 0px;
			// position: absolute;
			// transform: translate(-50%, -50%);
			// justify-content: space-around;
		}
		.nav1 span {
			font-size: 25px;
			cursor: pointer;
			visible: hidden;
            padding: 10px 0px;
			font-weight: bold;
			text-align: center;
		}
		.nav1 .prev, .next {
			flex: 1;
		}
		.nav1 .menu {
			width: 35px;    
			flex-shrink: 0;
			display: inline-block;
		}

		.menu1 {
			width: 100%;
			height: 100%;
			padding: 10px;
			top: 50%;
			left: 50%;
			display: flex;
			display: none;
			position: absolute;
			flex-direction: column;
			transform: translate(-50%, -50%);
			background-color: rgba(0,0,0,0.1);
		}
		.menu1 > div {
			background-color: white;
		}
		.menu1 .menus {
			flex: 1;
			overflow: scroll;
		}
		.menu1 .tools {
			height: 50px;
			display: flex;
		}
		.menu1 .tools .close {
			flex: 1;
			font-size: 40px;
			line-height: 40px;
			text-align: center;
		}
		
		.menus .title {
			display: flex;
		}
		.menus .title .text {
			flex: 1;
		}
		.menus .title > .text {
			text-align: center;
		}
		.menus .title .load {
			width: 50px;
			display: none;
		}
		.items {
			display: none;
		}
		
    </style>
</head>

<body>

<div class="container">
	<div><span id="title"></span></div>
	<div class="data">
		<div id="content"></div>
	</div>
	<div class="nav1">
		<span class="menu left">☰</span>
		<span class="prev">&lt;</span>
		<span class="next">&gt;</span>
		<span class="menu right">☰</span>
	</div>
	<div class="menu1">
		<div class="menus">
			<div class="title"><span class="text">loading...</span></div>
			<div class="items">
				<div class="item">
					<div class="title"><span class="text">11</span><span class="load">loading...</span></div>
				</div>
			</div>
		</div>
		<div class="tools">
			<span class="close">×</span>
		</div>
	</div>
</div>

<script type="text/javascript" src="../static/js/jquery.js"></script>
<script type="text/javascript" src="../static/js/marked.min.js"></script>
<script type="text/javascript">
	
	var menus = {};
	var index = [];
	var items = [];
	var currentIndex = 0;
	
	function addIndex(key, _items) {
		key = key || '';
		for (let k in _items) {
			index[index.length] = {
				name: _items[k].name,
				path: key + '/' + k + (k.endsWith('.md') ? '' : '/index.md')
			};
			if (_items[k].children) {
				addIndex(key + '/' + k, _items[k].children);
			}
		}
	}
	
	function refreshIndex(key, _items) {
		let _currentIndex = index[currentIndex] && index[currentIndex].path || 0;
		index = [];
		addIndex(null, menus.children);
		changeIndex(_currentIndex);
	}
	
	function changeIndex(num) {
		if ('number' !== typeof(num)) {
			index.forEach((v, i) => {
				if (v.path === num) currentIndex = i;
			});
			return;
		}
		if (currentIndex + num >= index.length || currentIndex + num <= -1) return;
		currentIndex += num;
	}
		
	function loadIndex(key, callback) {
		key = key || '';
		$.getJSON('./ileler/' + key + '/0.index', function (d) {
			d = d || '';
			let current = menus;
			key.split('/').forEach(k => {
				if (!k)	return;
				current = current.children[k];
			});
			
			current.children = {};
			current = current.children;
			for (let k in d) {
				current[k] = {
					name: d[k]
				};
			}
			refreshIndex();
		}).always(function() {
			callback && callback();
		});
	}
	
	function loadContent(key, callback) {
		$.get('./ileler/' + (key||'index.md'), function (d) {
			items[key] = d;
		}).fail(() => {
		}).always(function() {
			callback && callback();
		});
	}
		
	function changeContent(_index, callback) {
		let startTime = Date.now();
		callback = callback || ((index, item) => {
			if (index !== currentIndex) return;
			let _time = Date.now() - startTime;
			setTimeout(() => $('#content').html(item ? marked(item.trim()) : '<span class="center">(｀・ω・´)</span>'), _time < 800 ? 800 : 800 - _time);
		});
		currentIndex = _index || currentIndex;
		$('#title').html(index[currentIndex].name);
		$('#content').html('<span class="center">loading...</span>');
		let key = index[currentIndex].path;
		let item = items[key];
		if (item) {
			callback(currentIndex, item);
		} else {
			loadContent(key, () => {callback(currentIndex, items[key])});
		}
		
		//$('.next').css('visibility', 'hidden');
		//$('.prev').css('visibility', 'hidden');
		//$('.next').css('visibility', contents && dataIndex < contents.length - 1 ? 'visible' : 'hidden');
		//$('.prev').css('visibility', dataIndex > 0 ? 'visible' : 'hidden');
		//if (!contents || dataIndex >= contents.length || dataIndex < 0) return;
		//$("[name='" + tag + "']").addClass("selected").siblings().removeClass("selected");
	}

    $(document).ready(function () {
		$('body').css('width', $(window).width()).css('height', $(window).height());
		
		$('.nav1 .menu').click(() => {
			$('.menu1').css('display', 'flex');
		});
		$('.close').click(() => {
			$('.menus').parent().hide();
		});

		$('.prev').click((e) => {
			changeIndex(-1);
			changeContent();
		});

		$('.next').click((e) => {
			changeIndex(1);
			changeContent();
		});
		
		loadIndex(null, () => {
			changeContent();
		});

    });
</script>
</body>

</html>