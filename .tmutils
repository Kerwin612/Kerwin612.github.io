#!$PREFIX/bin/bash


update() {
    #update sources.list
    sl=$PREFIX/etc/apt/sources.list
    slb=$PREFIX/etc/apt/sources.list.bak
    if [ ! -e $slb ]; then
        cp $sl $slb
        echo -e "\
# The main termux repository:\n\
#deb [arch=all,arm] https://termux.net stable main\n\
deb [arch=all,arm] https://mirrors.tuna.tsinghua.edu.cn/termux stable main" > $sl
    else
        mv $slb $sl
    fi
    pkg update && pkg upgrade -y
}


sssh() {
    #install ssh
    sv=`pkg list-installed|grep openssh|awk '{print $2}'`
    if [ -z $sv ]; then
        pkg install openssh -y
    fi
    mkdir -p $HOME/.ssh && echo -e "\
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9w+lZ0IK7lsG1RPJkBeO5/Ap2uiRPNJBE6TK0TnCyLdtcHqNNuq0t3LmP2ma9YONSwBBV/+lP/NTIJ4WDihJravBlkD5TV/a7QoAEegf37k9Q/NOFcVVYy59LEZ9M+pJTyZuK5Xx6kWoELSa7YZh59CG7HqmSR8nK0eDCR71JBrHutCcle/uNs01K6hmcqo7G4ZAXrtciczICPZa1hUhgu3aDdxwljPBz2V7xtMnAVkvQrs4IzRyUKjvHgDBil9tMHWPwkpSgEUYiuKqFNQvzNhPv5PTQtEgStw2ZPQDnk7EcAhlw76vvJx/xYItFoeocmd7Uc1bBynPilSymkhkL zhangle@zhangle-PC\
\n" > $HOME/authorized_keys

    #start ssh
    sshd
    uname=`whoami`
    ip=`ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk '{print $2}'|tr -d "addr:"`
    echo "ssh $uname@$ip -p 8022"
}


ihass() {
    #install ha rt env
    pkg install clang python python-dev libcrypt-dev -y
    mkdir -p .pip && echo -e "\
[global]\n\
trusted-host = mirrors.ustc.edu.cn\n\
index-url = https://mirrors.ustc.edu.cn/pypi/web/simple" > .pip/pip.conf

    #install ha
    pip install netifaces homeassistant
}
